/*! For license information please see 447.214c5ef1.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbook_critic_fe=self.webpackChunkbook_critic_fe||[]).push([[447],{2330:(e,s,t)=>{var a=t(5043);var i="function"===typeof Object.is?Object.is:function(e,s){return e===s&&(0!==e||1/e===1/s)||e!==e&&s!==s},r=a.useState,n=a.useEffect,l=a.useLayoutEffect,o=a.useDebugValue;function d(e){var s=e.getSnapshot;e=e.value;try{var t=s();return!i(e,t)}catch(a){return!0}}var c="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,s){return s()}:function(e,s){var t=s(),a=r({inst:{value:t,getSnapshot:s}}),i=a[0].inst,c=a[1];return l(function(){i.value=t,i.getSnapshot=s,d(i)&&c({inst:i})},[e,t,s]),n(function(){return d(i)&&c({inst:i}),e(function(){d(i)&&c({inst:i})})},[e]),o(t),t};s.useSyncExternalStore=void 0!==a.useSyncExternalStore?a.useSyncExternalStore:c},7386:(e,s,t)=>{t.d(s,{z:()=>i});var a=t(6291);const i={getUsers:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return a.A.get("/admin/users?skip=".concat(e,"&take=").concat(s))},getUserById:async e=>a.A.get("/admin/users/".concat(e)),updateUser:async(e,s)=>a.A.patch("/admin/users/".concat(e),s),deleteUser:async e=>a.A.delete("/admin/users/".concat(e)),getDashboardStats:async()=>a.A.get("/admin/dashboard/stats"),getReviewsForModeration:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return a.A.get("/admin/reviews/moderation?skip=".concat(e,"&take=").concat(s))},approveReview:async e=>a.A.post("/admin/reviews/".concat(e,"/approve")),rejectReview:async e=>a.A.post("/admin/reviews/".concat(e,"/reject"))}},7923:(e,s,t)=>{t.r(s),t.d(s,{AdminUsersPage:()=>y});var a=t(2555),i=t(5043),r=t(5604),n=t(9781),l=t(2836),o=t(709),d=t(383),c=t(1561),m=t(764),x=t(8964),u=t(684),p=t(7386),h=t(579);const y=()=>{const{isAdmin:e}=(0,u.A)(),s=(0,n.jE)(),[t,y]=(0,i.useState)(1),[g,f]=(0,i.useState)(!1),[b,v]=(0,i.useState)(null),[j,N]=(0,i.useState)({id:"",displayName:"",email:"",role:"user"}),[w,k]=(0,i.useState)(""),{data:S,isLoading:A,error:U}=(0,r.I)(["adminUsers",t],()=>p.z.getUsers(10*(t-1),10),{keepPreviousData:!0,staleTime:3e5,enabled:e}),C=(0,l.n)(e=>p.z.updateUser(e.id,{displayName:e.displayName,role:e.role}),{onSuccess:()=>{s.invalidateQueries(["adminUsers"]),E(),f(!1)},onError:e=>{k((null===e||void 0===e?void 0:e.message)||"Failed to update user. Please try again.")}}),P=(0,l.n)(e=>p.z.deleteUser(e),{onSuccess:()=>{s.invalidateQueries(["adminUsers"])},onError:e=>{alert((null===e||void 0===e?void 0:e.message)||"Failed to delete user. Please try again.")}}),E=()=>{N({id:"",displayName:"",email:"",role:"user"}),v(null),k("")},z=e=>{const{name:s,value:t}=e.target;N(e=>(0,a.A)((0,a.A)({},e),{},{[s]:t}))};return e?(0,h.jsx)(o.P,{children:(0,h.jsxs)(d.m,{className:"py-8",children:[(0,h.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"User Management"}),(0,h.jsx)("p",{className:"mt-2 text-lg text-gray-600",children:"Manage user accounts and permissions."}),(0,h.jsx)("div",{className:"mt-8 flex flex-col",children:(0,h.jsx)("div",{className:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,h.jsx)("div",{className:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8",children:(0,h.jsx)("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:A?(0,h.jsx)("div",{className:"flex justify-center py-12",children:(0,h.jsx)(c.y,{size:"lg"})}):U?(0,h.jsx)("div",{className:"p-6",children:(0,h.jsx)(m.F,{type:"error",children:"Failed to load users. Please try again later."})}):S&&S.users.length>0?(0,h.jsxs)("table",{className:"min-w-full divide-y divide-gray-300",children:[(0,h.jsx)("thead",{className:"bg-gray-50",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6",children:"Name"}),(0,h.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Email"}),(0,h.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Role"}),(0,h.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Joined"}),(0,h.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Reviews"}),(0,h.jsx)("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:(0,h.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,h.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:S.users.map(e=>{return(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6",children:e.displayName}),(0,h.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.email}),(0,h.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:(0,h.jsx)("span",{className:"inline-flex rounded-full px-2 text-xs font-semibold leading-5 ".concat("admin"===e.role?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"),children:e.role})}),(0,h.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.createdAt?(s=e.createdAt,new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})):"N/A"}),(0,h.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.reviewCount||0}),(0,h.jsxs)("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:[(0,h.jsx)("button",{onClick:()=>(e=>{v(e),N({id:e.id,displayName:e.displayName,email:e.email,role:e.role}),f(!0)})(e),className:"text-primary-600 hover:text-primary-900 mr-4",children:"Edit"}),(0,h.jsx)("button",{onClick:()=>{return s=e.id,void(window.confirm("Are you sure you want to delete this user? This action cannot be undone.")&&P.mutate(s));var s},className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id);var s})})]}):(0,h.jsx)("div",{className:"p-6 text-center text-gray-500",children:"No users found."})})})})}),S&&S.total>10&&(0,h.jsx)("div",{className:"mt-6 flex justify-center",children:(0,h.jsx)(x.d,{currentPage:t,totalPages:Math.ceil(S.total/10),onPageChange:e=>{y(e)}})}),g&&(0,h.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,h.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,h.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>f(!1)}),(0,h.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"\u200b"}),(0,h.jsx)("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:(0,h.jsx)("div",{className:"sm:flex sm:items-start",children:(0,h.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full",children:[(0,h.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Edit User"}),w&&(0,h.jsx)(m.F,{type:"error",className:"mt-4",onClose:()=>k(""),children:w}),(0,h.jsxs)("form",{onSubmit:e=>{e.preventDefault(),k(""),j.displayName.trim()?C.mutate(j):k("Display name is required")},className:"mt-6 space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700",children:"Display Name"}),(0,h.jsx)("input",{type:"text",name:"displayName",id:"displayName",value:j.displayName,onChange:z,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,h.jsx)("input",{type:"email",name:"email",id:"email",value:j.email,disabled:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 bg-gray-50 text-gray-500 sm:text-sm"}),(0,h.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Email cannot be changed."})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:"Role"}),(0,h.jsxs)("select",{id:"role",name:"role",value:j.role,onChange:z,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm",children:[(0,h.jsx)("option",{value:"user",children:"User"}),(0,h.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,h.jsxs)("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[(0,h.jsx)("button",{type:"submit",disabled:C.isLoading,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:C.isLoading?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.y,{size:"sm",color:"text-white",className:"mr-2"}),"Updating..."]}):"Update"}),(0,h.jsx)("button",{type:"button",onClick:()=>f(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:w-auto sm:text-sm",children:"Cancel"})]})]})]})})})]})})]})}):(0,h.jsx)(o.P,{children:(0,h.jsx)(d.m,{className:"py-12",children:(0,h.jsx)(m.F,{type:"error",children:"You do not have permission to access this page."})})})}},8964:(e,s,t)=>{t.d(s,{d:()=>i});t(5043);var a=t(579);const i=e=>{let{currentPage:s,totalPages:t,onPageChange:i,className:r=""}=e;if(t<=1)return null;return(0,a.jsxs)("nav",{className:"flex items-center justify-between border-t border-gray-200 px-4 sm:px-0 py-3 ".concat(r),"aria-label":"Pagination",children:[(0,a.jsx)("div",{className:"hidden sm:block",children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing page ",(0,a.jsx)("span",{className:"font-medium",children:s})," of"," ",(0,a.jsx)("span",{className:"font-medium",children:t})]})}),(0,a.jsxs)("div",{className:"flex flex-1 justify-between sm:justify-end",children:[(0,a.jsx)("button",{onClick:()=>i(s-1),disabled:1===s,className:"relative inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,a.jsx)("div",{className:"hidden sm:flex sm:items-center",children:(0,a.jsx)("div",{className:"flex items-center space-x-1",children:(()=>{const e=[];e.push(1);const a=Math.max(2,s-1),i=Math.min(t-1,s+1);a>2&&e.push(-1);for(let s=a;s<=i;s++)e.push(s);return i<t-1&&e.push(-2),t>1&&e.push(t),e})().map((e,t)=>e<0?(0,a.jsx)("span",{className:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700",children:"..."},e):(0,a.jsx)("button",{onClick:()=>i(e),className:"relative inline-flex items-center px-4 py-2 text-sm font-semibold ".concat(e===s?"bg-primary-600 text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"),"aria-current":e===s?"page":void 0,children:e},e))})}),(0,a.jsx)("button",{onClick:()=>i(s+1),disabled:s===t,className:"relative ml-3 inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})}},9461:(e,s,t)=>{e.exports=t(2330)}}]);
//# sourceMappingURL=447.214c5ef1.chunk.js.map